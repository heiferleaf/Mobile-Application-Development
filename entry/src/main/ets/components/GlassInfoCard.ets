import { SimpleDiaryRecord } from '../common/SimpleDiaryRecord';

@Component
export default struct GlassInfoCard {
  @Prop record: SimpleDiaryRecord;
  @Prop bgcolor: string = 'rgba(255, 255, 255, 0.6)'; // é»˜è®¤æé€

  // --- Builders (ä¸¥æ ¼éµå¾ª ArkTS è¯­æ³•ï¼Œé€»è¾‘å°è£…åœ¨ Builder ä¸­) ---

  @Builder
  renderLocation() {
    if (this.record.location && this.record.location.length > 0) {
      Row() {
        Text(this.formatTime(this.record.time))
          .fontColor('#8A8077') // æš–ç°
          .fontSize(12)
        Text(' Â· ' + this.record.location)
          .fontColor('#A9CABF') // æ·¡é’è‰²ï¼Œå‘¼åº”æ°´å½©
          .fontSize(12)
      }
      .margin({ top: 10 })
    } else {
      Row() {
        Text(this.formatTime(this.record.time))
          .fontColor('#8A8077')
          .fontSize(12)
      }
      .margin({ top: 10 })
    }
  }

  @Builder
  renderImageArea() {
    if (this.record.type === 'image') {
      if (this.record.imageUrl && this.record.imageUrl.length > 0) {
        Image(this.record.imageUrl)
          .width('100%')
          .height(100)
          .objectFit(ImageFit.Cover)
          .borderRadius(12)
          .margin({ top: 12 })
      } else {
        // å ä½å›¾é€»è¾‘
        Image($r('app.media.card_placeholder')) // è¯·ç¡®ä¿æœ‰æ­¤å›¾ç‰‡ï¼Œæˆ–æš‚æ—¶ç”¨çº¯è‰²
          .width('100%')
          .height(80)
          .objectFit(ImageFit.Contain)
          .opacity(0.5)
          .margin({ top: 12 })
      }
    } else {
      // æ–‡æœ¬/è¯­éŸ³ç±»å‹ä¸æ˜¾ç¤ºå¤§å›¾ï¼Œç”¨ç©ºç™½å ä½ä¿æŒå¸ƒå±€
      Blank()
    }
  }

  // --- ä¸» Build ---

  build() {
    // é˜²å¾¡æ€§ç¼–ç¨‹ï¼šå¦‚æœæ•°æ®ä¸ºç©ºï¼Œæ¸²æŸ“é€æ˜å ä½
    if (!this.record) {
      Column().width('100%').height('100%')
    } else {
      Column() {
        // 1. é¡¶éƒ¨ï¼šå›¾æ ‡ + æ—¶é—´åœ°ç‚¹
        Row() {
          Text(this.getTypeEmoji(this.record.type))
            .fontSize(24)
            .margin({ right: 8 })

          this.renderLocation()
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // 2. å†…å®¹æ‘˜è¦
        Text(this.record.content)
          .fontSize(16)
          .fontColor('#4A3F35') // æ·±è¤è‰²ï¼Œæ¯”çº¯é»‘æ›´æŸ”å’Œ
          .fontWeight(FontWeight.Medium)
          .maxLines(3)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
          .margin({ top: 12 })
          .lineHeight(24)

        // 3. å›¾ç‰‡åŒº (Builder)
        this.renderImageArea()
      }
      .width('100%')
      .height('100%')
      .padding(20)
      .backgroundColor(this.bgcolor) //ä¸»è¦èƒŒæ™¯è‰²
      .backdropBlur(20) // å…³é”®ï¼šèƒŒæ™¯æ¨¡ç³Šï¼Œå®ç°æ¯›ç»ç’ƒè´¨æ„Ÿ
      .borderRadius(24)
      .border({ width: 0.5, color: 'rgba(255,255,255,0.4)' }) // æç»†çš„ç»ç’ƒè¾¹ç¼˜å…‰
      .shadow({ radius: 15, color: 'rgba(166, 145, 129, 0.1)', offsetY: 5 }) // æš–è‰²æŸ”å’Œé˜´å½±
    }
  }

  // --- Helpers ---
  private getTypeEmoji(type: string): string {
    switch (type) {
      case 'text': return 'ğŸ“';
      case 'image': return 'ğŸ–¼ï¸';
      case 'voice': return 'ğŸ™ï¸';
      default: return 'ğŸ“Œ';
    }
  }

  private formatTime(time: string): string {
    if (!time) return '';
    let parts = time.split(' ');
    return parts.length > 1 ? parts[1] : time;
  }
}